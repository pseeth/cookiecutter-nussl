

<!DOCTYPE html>
<!--[if IE 8]><html class="no-js lt-ie9" lang="en" > <![endif]-->
<!--[if gt IE 8]><!--> <html class="no-js" lang="en" > <!--<![endif]-->
<head>
  <meta charset="utf-8">
  
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  
  <title>nussl.deep.datasets.scaper_dataset &mdash; Cookiecutter for nussl  documentation</title>
  

  
  
  
  

  
  <script type="text/javascript" src="../../../../_static/js/modernizr.min.js"></script>
  
    
      <script type="text/javascript" id="documentation_options" data-url_root="../../../../" src="../../../../_static/documentation_options.js"></script>
        <script type="text/javascript" src="../../../../_static/jquery.js"></script>
        <script type="text/javascript" src="../../../../_static/underscore.js"></script>
        <script type="text/javascript" src="../../../../_static/doctools.js"></script>
        <script type="text/javascript" src="../../../../_static/language_data.js"></script>
    
    <script type="text/javascript" src="../../../../_static/js/theme.js"></script>

    

  
  <link rel="stylesheet" href="../../../../_static/css/theme.css" type="text/css" />
  <link rel="stylesheet" href="../../../../_static/pygments.css" type="text/css" />
    <link rel="index" title="Index" href="../../../../genindex.html" />
    <link rel="search" title="Search" href="../../../../search.html" /> 
</head>

<body class="wy-body-for-nav">

   
  <div class="wy-grid-for-nav">
    
    <nav data-toggle="wy-nav-shift" class="wy-nav-side">
      <div class="wy-side-scroll">
        <div class="wy-side-nav-search" >
          

          
            <a href="../../../../index.html" class="icon icon-home"> Cookiecutter for nussl
          

          
          </a>

          
            
            
          

          
<div role="search">
  <form id="rtd-search-form" class="wy-form" action="../../../../search.html" method="get">
    <input type="text" name="q" placeholder="Search docs" />
    <input type="hidden" name="check_keywords" value="yes" />
    <input type="hidden" name="area" value="default" />
  </form>
</div>

          
        </div>

        <div class="wy-menu wy-menu-vertical" data-spy="affix" role="navigation" aria-label="main navigation">
          
            
            
              
            
            
              <ul>
<li class="toctree-l1"><a class="reference internal" href="../../../../intro.html">Introduction</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../../../getting_started.html">Getting started</a></li>
</ul>
<ul>
<li class="toctree-l1"><a class="reference internal" href="../../../../using_scaper.html">Using Scaper</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../../../experiments.html">Configuring an experiment</a></li>
</ul>
<ul>
<li class="toctree-l1"><a class="reference internal" href="../../../../source/runners.html">runners</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../../../source/scripts.html">scripts</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../../../source/src.html">src</a></li>
</ul>

            
          
        </div>
      </div>
    </nav>

    <section data-toggle="wy-nav-shift" class="wy-nav-content-wrap">

      
      <nav class="wy-nav-top" aria-label="top navigation">
        
          <i data-toggle="wy-nav-top" class="fa fa-bars"></i>
          <a href="../../../../index.html">Cookiecutter for nussl</a>
        
      </nav>


      <div class="wy-nav-content">
        
        <div class="rst-content">
        
          















<div role="navigation" aria-label="breadcrumbs navigation">

  <ul class="wy-breadcrumbs">
    
      <li><a href="../../../../index.html">Docs</a> &raquo;</li>
        
          <li><a href="../../../index.html">Module code</a> &raquo;</li>
        
      <li>nussl.deep.datasets.scaper_dataset</li>
    
    
      <li class="wy-breadcrumbs-aside">
        
      </li>
    
  </ul>

  
  <hr/>
</div>
          <div role="main" class="document" itemscope="itemscope" itemtype="http://schema.org/Article">
           <div itemprop="articleBody">
            
  <h1>Source code for nussl.deep.datasets.scaper_dataset</h1><div class="highlight"><pre>
<span></span>from .base_dataset import BaseDataset
import librosa
import jams
import os
import numpy as np

<div class="viewcode-block" id="Scaper"><a class="viewcode-back" href="../../../../source/src.dataset.html#src.dataset.Scaper">[docs]</a>class Scaper(BaseDataset):
    def __init__(self, folder, options):
        &quot;&quot;&quot;This dataset expects that your data was mixed using Scaper, which generates
        mixtures from a given source library. Scaper generates a bunch of JSON files
        which are then parsed by this dataset class. Each JSON file contains all of the
        metadata to find the sources that went into the mixture, the mixture itself (must
        have the same name as the JSON file but with a different extension), and the 
        classes of the sources. This JSON file is processed here to load the mixture
        and sources, and label the sources.

        For now, Scaper datasets must be mixed by this fork of Scaper, kept here:
            https://github.com/pseeth/scaper

        This fork saves the sources alongside the mixture. Datasets created using this
        fork can be immediately used for training a deep source separation model by
        using this Dataset class.
        &quot;&quot;&quot;
        super(Scaper, self).__init__(folder, options)

        #initialization
        jam_file = self.files[0]
        jam = jams.load(jam_file)
        
        if not self.options[&#39;source_labels&#39;]:
            self.options[&#39;source_labels&#39;] = jam.annotations[0][&#39;sandbox&#39;][&#39;scaper&#39;][&#39;fg_labels&#39;]
        
        for group in self.options[&#39;group_sources&#39;]:
            group_name = &#39;+&#39;.join(group)
            self.options[&#39;source_labels&#39;].append(group_name)

<div class="viewcode-block" id="Scaper.get_files"><a class="viewcode-back" href="../../../../source/src.dataset.html#src.dataset.Scaper.get_files">[docs]</a>    def get_files(self, folder):
        files = sorted(
            [os.path.join(folder, x.replace(&#39;.wav&#39;, &#39;.jams&#39;)) for x in os.listdir(folder) 
            if &#39;.wav&#39; in x
        ])
        return files</div>

<div class="viewcode-block" id="Scaper.load_audio_files"><a class="viewcode-back" href="../../../../source/src.dataset.html#src.dataset.Scaper.load_audio_files">[docs]</a>    def load_audio_files(self, file_name):
        mix = self._load_audio_file(file_name.replace(&#39;.jams&#39;, &#39;.wav&#39;))
        source_folder = file_name.replace(&#39;.jams&#39;, &#39;_sources&#39;)
        jam = jams.load(file_name)
        data = jam.annotations[0][&#39;data&#39;]      
        classes = self.options[&#39;source_labels&#39;]
        source_dict = {}
        lengths = [mix.signal_length]

        for datum in data:
            d = datum.value
            if d[&#39;role&#39;] == &#39;foreground&#39;:
                source_path = os.path.join(source_folder, d[&#39;audio_path&#39;] + &#39;.wav&#39;)
                source_dict[d[&#39;label&#39;]] = self._load_audio_file(source_path)
                lengths.append(source_dict[d[&#39;label&#39;]].signal_length)

        min_length = min(lengths)
        mix.audio_data = mix.audio_data[:, :min_length]
        for key in source_dict:
            source_dict[key].audio_data = source_dict[key].audio_data[:, :min_length]

        for i, group in enumerate(self.options[&#39;group_sources&#39;]):
            combined = []
            for label in group:
                combined.append(source_dict[label])
                source_dict.pop(label)
            group_name = &#39;+&#39;.join(group)
            source_dict[group_name] = sum(combined)

        sources = []
        one_hots = []

        for i, label in enumerate(classes):
            if label in source_dict:
                sources.append(source_dict[label])
                one_hot = np.zeros(len(classes))
                one_hot[classes.index(label)] = 1
                one_hots.append(one_hot)
        one_hots = np.stack(one_hots)
        return mix, sources, one_hots</div></div>
</pre></div>

           </div>
           
          </div>
          <footer>
  

  <hr/>

  <div role="contentinfo">
    <p>
        &copy; Copyright 2020, Prem Seetharaman

    </p>
  </div>
  Built with <a href="http://sphinx-doc.org/">Sphinx</a> using a <a href="https://github.com/rtfd/sphinx_rtd_theme">theme</a> provided by <a href="https://readthedocs.org">Read the Docs</a>. 

</footer>

        </div>
      </div>

    </section>

  </div>
  


  <script type="text/javascript">
      jQuery(function () {
          SphinxRtdTheme.Navigation.enable(true);
      });
  </script>

  
  
    
   

</body>
</html>