

<!DOCTYPE html>
<!--[if IE 8]><html class="no-js lt-ie9" lang="en" > <![endif]-->
<!--[if gt IE 8]><!--> <html class="no-js" lang="en" > <!--<![endif]-->
<head>
  <meta charset="utf-8">
  
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  
  <title>nussl.deep.datasets.mix_source_folder_dataset &mdash; Cookiecutter for nussl  documentation</title>
  

  
  
  
  

  
  <script type="text/javascript" src="../../../../_static/js/modernizr.min.js"></script>
  
    
      <script type="text/javascript" id="documentation_options" data-url_root="../../../../" src="../../../../_static/documentation_options.js"></script>
        <script type="text/javascript" src="../../../../_static/jquery.js"></script>
        <script type="text/javascript" src="../../../../_static/underscore.js"></script>
        <script type="text/javascript" src="../../../../_static/doctools.js"></script>
        <script type="text/javascript" src="../../../../_static/language_data.js"></script>
    
    <script type="text/javascript" src="../../../../_static/js/theme.js"></script>

    

  
  <link rel="stylesheet" href="../../../../_static/css/theme.css" type="text/css" />
  <link rel="stylesheet" href="../../../../_static/pygments.css" type="text/css" />
    <link rel="index" title="Index" href="../../../../genindex.html" />
    <link rel="search" title="Search" href="../../../../search.html" /> 
</head>

<body class="wy-body-for-nav">

   
  <div class="wy-grid-for-nav">
    
    <nav data-toggle="wy-nav-shift" class="wy-nav-side">
      <div class="wy-side-scroll">
        <div class="wy-side-nav-search" >
          

          
            <a href="../../../../index.html" class="icon icon-home"> Cookiecutter for nussl
          

          
          </a>

          
            
            
          

          
<div role="search">
  <form id="rtd-search-form" class="wy-form" action="../../../../search.html" method="get">
    <input type="text" name="q" placeholder="Search docs" />
    <input type="hidden" name="check_keywords" value="yes" />
    <input type="hidden" name="area" value="default" />
  </form>
</div>

          
        </div>

        <div class="wy-menu wy-menu-vertical" data-spy="affix" role="navigation" aria-label="main navigation">
          
            
            
              
            
            
              <ul>
<li class="toctree-l1"><a class="reference internal" href="../../../../intro.html">Introduction</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../../../getting_started.html">Getting started</a></li>
</ul>
<ul>
<li class="toctree-l1"><a class="reference internal" href="../../../../using_scaper.html">Using Scaper</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../../../experiments.html">Configuring an experiment</a></li>
</ul>
<ul>
<li class="toctree-l1"><a class="reference internal" href="../../../../source/runners.html">runners</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../../../source/scripts.html">scripts</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../../../source/src.html">src</a></li>
</ul>

            
          
        </div>
      </div>
    </nav>

    <section data-toggle="wy-nav-shift" class="wy-nav-content-wrap">

      
      <nav class="wy-nav-top" aria-label="top navigation">
        
          <i data-toggle="wy-nav-top" class="fa fa-bars"></i>
          <a href="../../../../index.html">Cookiecutter for nussl</a>
        
      </nav>


      <div class="wy-nav-content">
        
        <div class="rst-content">
        
          















<div role="navigation" aria-label="breadcrumbs navigation">

  <ul class="wy-breadcrumbs">
    
      <li><a href="../../../../index.html">Docs</a> &raquo;</li>
        
          <li><a href="../../../index.html">Module code</a> &raquo;</li>
        
      <li>nussl.deep.datasets.mix_source_folder_dataset</li>
    
    
      <li class="wy-breadcrumbs-aside">
        
      </li>
    
  </ul>

  
  <hr/>
</div>
          <div role="main" class="document" itemscope="itemscope" itemtype="http://schema.org/Article">
           <div itemprop="articleBody">
            
  <h1>Source code for nussl.deep.datasets.mix_source_folder_dataset</h1><div class="highlight"><pre>
<span></span>from .base_dataset import BaseDataset
import os
import numpy as np
import random

<div class="viewcode-block" id="MixSourceFolder"><a class="viewcode-back" href="../../../../source/src.dataset.html#src.dataset.MixSourceFolder">[docs]</a>class MixSourceFolder(BaseDataset):
    def __init__(self, folder, options):
        &quot;&quot;&quot;This dataset expects your data to be formatted in the following way:

            data/
                mix/
                    [file0].wav
                    [file1].wav
                    [file2].wav
                    ...
                s0/
                    [file0].wav
                    [file1].wav
                    [file2].wav
                    ...
                s1/
                    [file0].wav
                    [file1].wav
                    [file2].wav
                    ...
                s2/
                    [file0].wav
                    [file1].wav
                    [file2].wav
                    ...
                ...
        
        Note that the the filenames match between the mix folder and each source folder.
        The only protected folder name here is &#39;mix&#39;. The source folder names can be
        whatever you want. Given a file in the &#39;mix&#39; folder, this dataset will look up
        the corresponding files with the same name in the source folders. These are the
        source audio files. The sum of the sources should equal the mixture. Each source
        will be labeled according to the folder name it comes from.
        
        If no mix folder exists, then this class will use the files in the first source
        folder and look for matching files in the other source folder. Then the mix
        will be created by summing the sources on the fly. This can also happen
        if there is a mix folder by setting self.options[&#39;sum_sources&#39;] = True.

        Arguments:
            folder: location where all the data lives that is in MixSourceFolder format.
            options: the options for the dataset (see deep/config/defaults/dataset.json)
                for more details.            
        &quot;&quot;&quot;
        super(MixSourceFolder, self).__init__(folder, options)
        if self.create_mix:
            wav_file = os.path.join(self.folder, self.source_folders[0], self.files[0])
        else:
            wav_file = os.path.join(self.folder, &#39;mix&#39;, self.files[0])
        
        mix = self._load_audio_file(wav_file)
        self.channels_in_mix = mix.num_channels
        self.sum_sources = self.options.pop(&#39;sum_sources&#39;, False)

<div class="viewcode-block" id="MixSourceFolder.get_files"><a class="viewcode-back" href="../../../../source/src.dataset.html#src.dataset.MixSourceFolder.get_files">[docs]</a>    def get_files(self, folder):
        self.source_folders = sorted([
            x for x in os.listdir(folder) 
            if os.path.isdir(os.path.join(folder, x)) 
            and &#39;mix&#39; not in x and &#39;cache&#39; not in x
        ])
        if not self.options[&#39;source_labels&#39;]:
            self.options[&#39;source_labels&#39;] = self.source_folders

        for group in self.options[&#39;group_sources&#39;]:
            group_name = &#39;+&#39;.join(group)
            self.options[&#39;source_labels&#39;].append(group_name)

        self.num_sources = len(self.source_folders)
        if os.path.exists(os.path.join(folder, &#39;mix&#39;)):
            self.create_mix = False
            files = sorted([x for x in os.listdir(os.path.join(folder, &#39;mix&#39;)) if &#39;.wav&#39; in x])
        else:
            self.create_mix = True
            files = sorted([x for x in os.listdir(os.path.join(folder, self.source_folders[0])) if &#39;.wav&#39; in x])
        return files</div>

<div class="viewcode-block" id="MixSourceFolder.load_audio_files"><a class="viewcode-back" href="../../../../source/src.dataset.html#src.dataset.MixSourceFolder.load_audio_files">[docs]</a>    def load_audio_files(self, wav_file):
        channel_indices = list(range(1, self.channels_in_mix))
        random.shuffle(channel_indices)
        channel_indices = [0] + channel_indices[:self.options[&#39;num_channels&#39;] - 1]
        source_dict = {}
        classes = self.options[&#39;source_labels&#39;]

        for source in self.source_folders:
            source_path = os.path.join(self.folder, source, wav_file)
            if os.path.isfile(source_path):
                source_signal = self._load_audio_file(source_path)
                source_signal.audio_data = source_signal.audio_data[channel_indices]
                source_dict[source] = source_signal

        if self.create_mix:
            mix_signal = sum([source_dict[x] for x in source_dict])
        else:
            mix_path = os.path.join(self.folder, &#39;mix&#39;, wav_file)
            mix_signal = self._load_audio_file(mix_path)
            mix_signal.audio_data = mix_signal.audio_data[channel_indices]

        for i, group in enumerate(self.options[&#39;group_sources&#39;]):
            combined = []
            for label in group:
                combined.append(source_dict[label])
                source_dict.pop(label)
            group_name = &#39;+&#39;.join(group)
            source_dict[group_name] = sum(combined)

        sources = []
        one_hots = []

        for i, label in enumerate(self.options[&#39;source_labels&#39;]):
            if label in source_dict:
                sources.append(source_dict[label])
                one_hot = np.zeros(len(classes))
                one_hot[classes.index(label)] = 1
                one_hots.append(one_hot)
        
        one_hots = np.stack(one_hots)
        if self.sum_sources:
            mix_signal = sum(sources)
        return mix_signal, sources, one_hots</div></div>
</pre></div>

           </div>
           
          </div>
          <footer>
  

  <hr/>

  <div role="contentinfo">
    <p>
        &copy; Copyright 2020, Prem Seetharaman

    </p>
  </div>
  Built with <a href="http://sphinx-doc.org/">Sphinx</a> using a <a href="https://github.com/rtfd/sphinx_rtd_theme">theme</a> provided by <a href="https://readthedocs.org">Read the Docs</a>. 

</footer>

        </div>
      </div>

    </section>

  </div>
  


  <script type="text/javascript">
      jQuery(function () {
          SphinxRtdTheme.Navigation.enable(true);
      });
  </script>

  
  
    
   

</body>
</html>